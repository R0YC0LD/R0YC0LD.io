<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NEXUS DAW - Pro Audio Workstation</title>
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-dark: #0f111a;
            --panel-bg: rgba(20, 24, 35, 0.85);
            --accent-primary: #00f2ff;
            --accent-secondary: #ff0055;
            --text-main: #e0e6ed;
            --text-dim: #6b7280;
            --grid-line: #1f2937;
            --knob-bg: #2d3748;
        }

        * { box-sizing: border-box; user-select: none; -webkit-user-drag: none; }

        body {
            margin: 0;
            background-color: var(--bg-dark);
            background-image: radial-gradient(circle at 50% 0%, #1a2035 0%, var(--bg-dark) 70%);
            color: var(--text-main);
            font-family: 'Rajdhani', sans-serif;
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        /* --- HEADER & TOP BAR --- */
        header {
            height: 70px;
            background: rgba(15, 17, 26, 0.95);
            border-bottom: 1px solid rgba(255,255,255,0.05);
            display: flex;
            align-items: center;
            padding: 0 30px;
            justify-content: space-between;
            backdrop-filter: blur(10px);
            z-index: 100;
        }

        .brand {
            font-size: 28px;
            font-weight: 700;
            letter-spacing: 2px;
            color: var(--text-main);
            text-shadow: 0 0 15px rgba(0, 242, 255, 0.3);
        }
        .brand span { color: var(--accent-primary); }

        .transport-controls {
            display: flex;
            gap: 15px;
            align-items: center;
            background: #161b25;
            padding: 8px 20px;
            border-radius: 30px;
            border: 1px solid rgba(255,255,255,0.05);
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }

        .btn-transport {
            background: none;
            border: none;
            color: var(--text-main);
            font-size: 20px;
            cursor: pointer;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .btn-transport:hover { background: rgba(255,255,255,0.1); color: var(--accent-primary); }
        .btn-transport.play { color: #00ff88; }
        .btn-transport.stop { color: #ff3366; }
        .btn-transport:active { transform: scale(0.9); }

        .bpm-control {
            display: flex;
            align-items: center;
            gap: 10px;
            background: #0f111a;
            padding: 5px 15px;
            border-radius: 4px;
            border: 1px solid #2d3748;
        }

        .bpm-display { font-family: 'Courier New', monospace; font-weight: bold; color: var(--accent-primary); width: 40px; text-align: right;}
        
        /* --- MAIN WORKSPACE --- */
        .workspace {
            display: flex;
            flex: 1;
            padding: 20px;
            gap: 20px;
            overflow: hidden;
        }

        /* --- SEQUENCER PANEL --- */
        .sequencer-container {
            flex: 3;
            background: var(--panel-bg);
            border-radius: 12px;
            border: 1px solid rgba(255,255,255,0.05);
            display: flex;
            flex-direction: column;
            overflow-y: auto;
            position: relative;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .track-header {
            padding: 15px;
            border-bottom: 1px solid rgba(255,255,255,0.05);
            display: flex;
            justify-content: space-between;
            color: var(--text-dim);
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
            position: sticky;
            top: 0;
            background: var(--panel-bg);
            z-index: 10;
        }

        .track-row {
            display: flex;
            height: 70px;
            border-bottom: 1px solid rgba(255,255,255,0.03);
            transition: background 0.2s;
        }

        .track-row:hover { background: rgba(255,255,255,0.02); }

        .track-controls {
            width: 180px;
            background: rgba(15, 17, 26, 0.5);
            border-right: 1px solid rgba(255,255,255,0.05);
            padding: 10px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            gap: 5px;
        }

        .track-name { font-weight: 700; color: var(--text-main); font-size: 14px; margin-bottom: 4px; display: flex; align-items: center; gap: 5px;}
        .led { width: 6px; height: 6px; border-radius: 50%; background: #333; box-shadow: 0 0 2px #000; transition: 0.1s; }
        .led.active { background: var(--accent-primary); box-shadow: 0 0 8px var(--accent-primary); }

        .track-utils { display: flex; gap: 5px; align-items: center; }
        
        /* Custom Checkbox for Mute/Solo */
        .util-btn {
            font-size: 10px;
            padding: 2px 6px;
            background: #2d3748;
            border: none;
            color: #888;
            border-radius: 3px;
            cursor: pointer;
        }
        .util-btn.active.mute { background: #ff3366; color: white; }
        .util-btn.active.solo { background: #00ff88; color: #000; }

        .vol-slider {
            -webkit-appearance: none;
            width: 100%;
            height: 4px;
            background: #1f2937;
            border-radius: 2px;
            outline: none;
        }
        .vol-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 10px;
            height: 10px;
            background: var(--text-main);
            border-radius: 50%;
            cursor: pointer;
        }

        .step-grid {
            flex: 1;
            display: grid;
            grid-template-columns: repeat(16, 1fr);
            gap: 2px;
            padding: 10px;
            position: relative;
        }

        .step {
            background: #1a202c;
            border-radius: 3px;
            cursor: pointer;
            position: relative;
            transition: all 0.15s ease;
        }

        .step:hover { background: #2d3748; }
        .step:nth-child(4n+1) { background: #232b3a; } /* Beat markers */

        .step.active {
            background: var(--accent-primary);
            box-shadow: 0 0 10px rgba(0, 242, 255, 0.4);
        }
        
        .step.current {
            border: 1px solid rgba(255,255,255,0.8);
            z-index: 2;
        }
        
        .step.active.current {
            background: #fff;
            box-shadow: 0 0 15px #fff;
        }

        /* --- VISUALIZER PANEL --- */
        .side-panel {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .visualizer-box {
            background: #000;
            border: 1px solid #333;
            border-radius: 8px;
            height: 150px;
            position: relative;
            overflow: hidden;
            box-shadow: inset 0 0 20px rgba(0,0,0,0.8);
        }
        
        canvas { width: 100%; height: 100%; display: block; }

        .info-panel {
            flex: 1;
            background: var(--panel-bg);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid rgba(255,255,255,0.05);
            font-size: 14px;
            color: #888;
        }
        
        .save-load-area { margin-top: 20px; display: flex; gap: 10px; }
        .btn-secondary {
            flex: 1;
            background: transparent;
            border: 1px solid var(--accent-primary);
            color: var(--accent-primary);
            padding: 8px;
            border-radius: 4px;
            cursor: pointer;
            transition: 0.2s;
            font-family: inherit;
            font-weight: 600;
        }
        .btn-secondary:hover { background: rgba(0, 242, 255, 0.1); }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #0f111a; }
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #444; }

    </style>
</head>
<body>

    <header>
        <div class="brand">NEXUS<span>DAW</span></div>
        
        <div class="transport-controls">
            <button class="btn-transport stop" id="stopBtn" title="Stop">■</button>
            <button class="btn-transport play" id="playBtn" title="Play">▶</button>
            <div style="width: 1px; height: 20px; background: #333; margin: 0 10px;"></div>
            <div class="bpm-control">
                <span style="font-size: 12px; color: #666;">BPM</span>
                <input type="range" id="bpmSlider" min="60" max="200" value="128" style="width: 80px;">
                <span class="bpm-display" id="bpmVal">128</span>
            </div>
        </div>
        
        <div style="width: 100px;"></div> </header>

    <div class="workspace">
        <div class="sequencer-container" id="sequencerTracks">
            <div class="track-header">
                <span>Instruments</span>
                <span>1 — 16 Steps</span>
            </div>
            </div>

        <div class="side-panel">
            <div class="visualizer-box">
                <canvas id="visualizerCanvas"></canvas>
            </div>
            
            <div class="info-panel">
                <h3 style="color:white; margin-top:0;">MASTER CHANNEL</h3>
                <p>Output Level: <span id="masterLevel">0</span> dB</p>
                <p>Active Voices: <span id="activeVoices">0</span></p>
                <hr style="border-color: #333">
                <p style="font-size: 12px; line-height: 1.5;">
                    Nexus DAW, Web Audio API kullanarak tarayıcı içinde gerçek zamanlı ses sentezi yapar. Sample kullanmaz, her ses matematiksel olarak anlık üretilir.
                </p>

                <div class="save-load-area">
                    <button class="btn-secondary" id="saveBtn">PROJEYİ KAYDET</button>
                    <button class="btn-secondary" id="loadBtn">YÜKLE</button>
                </div>
            </div>
        </div>
    </div>

<script>
    /**
     * NEXUS DAW CORE ENGINE
     * High-performance audio scheduling & synthesis
     */

    // --- AUDIO CONTEXT & MASTER CHAIN ---
    const AudioContext = window.AudioContext || window.webkitAudioContext;
    const ctx = new AudioContext();
    const masterGain = ctx.createGain();
    const analyser = ctx.createAnalyser();
    
    masterGain.gain.value = 0.5; // Master volume
    masterGain.connect(analyser);
    analyser.connect(ctx.destination);
    
    analyser.fftSize = 256;
    const bufferLength = analyser.frequencyBinCount;
    const dataArray = new Uint8Array(bufferLength);

    // --- SYNTHESIZER ENGINE (Ses Tasarımı) ---
    const Synth = {
        playKick: (time, vol) => {
            const osc = ctx.createOscillator();
            const gain = ctx.createGain();
            osc.connect(gain);
            gain.connect(masterGain);

            osc.frequency.setValueAtTime(150, time);
            osc.frequency.exponentialRampToValueAtTime(0.001, time + 0.5);
            gain.gain.setValueAtTime(vol, time);
            gain.gain.exponentialRampToValueAtTime(0.001, time + 0.5);

            osc.start(time);
            osc.stop(time + 0.5);
        },
        playSnare: (time, vol) => {
            // Noise
            const bufferSize = ctx.sampleRate * 0.5; // 0.5 sec
            const buffer = ctx.createBuffer(1, bufferSize, ctx.sampleRate);
            const data = buffer.getChannelData(0);
            for (let i = 0; i < bufferSize; i++) data[i] = Math.random() * 2 - 1;

            const noise = ctx.createBufferSource();
            noise.buffer = buffer;
            const noiseFilter = ctx.createBiquadFilter();
            noiseFilter.type = 'highpass';
            noiseFilter.frequency.value = 1000;
            const noiseGain = ctx.createGain();

            noise.connect(noiseFilter);
            noiseFilter.connect(noiseGain);
            noiseGain.connect(masterGain);

            noiseGain.gain.setValueAtTime(vol, time);
            noiseGain.gain.exponentialRampToValueAtTime(0.01, time + 0.2);
            noise.start(time);
            noise.stop(time + 0.2);

            // Tone
            const osc = ctx.createOscillator();
            const oscGain = ctx.createGain();
            osc.type = 'triangle';
            osc.connect(oscGain);
            oscGain.connect(masterGain);
            
            osc.frequency.setValueAtTime(200, time);
            oscGain.gain.setValueAtTime(vol * 0.5, time);
            oscGain.gain.exponentialRampToValueAtTime(0.01, time + 0.1);
            osc.start(time);
            osc.stop(time + 0.1);
        },
        playHiHat: (time, vol) => {
            const osc = ctx.createOscillator();
            const gain = ctx.createGain();
            osc.type = 'square';
            
            // Bandpass filter for metallic sound
            const filter = ctx.createBiquadFilter();
            filter.type = 'highpass';
            filter.frequency.value = 7000;

            osc.connect(filter);
            filter.connect(gain);
            gain.connect(masterGain);

            // Rastgele hafif pitch değişimi (insansı his)
            const randomFreq = 800 + Math.random() * 200;
            osc.frequency.setValueAtTime(randomFreq, time);
            osc.frequency.exponentialRampToValueAtTime(randomFreq/2, time + 0.05);

            gain.gain.setValueAtTime(vol * 0.6, time);
            gain.gain.exponentialRampToValueAtTime(0.01, time + 0.05);

            osc.start(time);
            osc.stop(time + 0.05);
        },
        playBass: (time, vol) => {
            const osc = ctx.createOscillator();
            const gain = ctx.createGain();
            osc.type = 'sawtooth';
            
            const filter = ctx.createBiquadFilter();
            filter.type = 'lowpass';
            filter.frequency.setValueAtTime(400, time);
            filter.frequency.linearRampToValueAtTime(100, time + 0.2);

            osc.connect(filter);
            filter.connect(gain);
            gain.connect(masterGain);

            osc.frequency.setValueAtTime(55, time); // A1 note
            gain.gain.setValueAtTime(vol * 0.8, time);
            gain.gain.linearRampToValueAtTime(0.01, time + 0.3);

            osc.start(time);
            osc.stop(time + 0.3);
        }
    };

    // --- STATE MANAGEMENT ---
    const config = {
        bpm: 128,
        tracks: [
            { name: "KICK DRUM", type: "kick", steps: new Array(16).fill(false), vol: 1, mute: false, solo: false },
            { name: "SNARE", type: "snare", steps: new Array(16).fill(false), vol: 0.8, mute: false, solo: false },
            { name: "HI-HATS", type: "hat", steps: new Array(16).fill(false), vol: 0.6, mute: false, solo: false },
            { name: "BASS SYNTH", type: "bass", steps: new Array(16).fill(false), vol: 0.7, mute: false, solo: false }
        ]
    };

    // Initialize default pattern
    config.tracks[0].steps[0] = true; config.tracks[0].steps[4] = true; 
    config.tracks[0].steps[8] = true; config.tracks[0].steps[12] = true;
    config.tracks[2].steps[2] = true; config.tracks[2].steps[6] = true;
    config.tracks[2].steps[10] = true; config.tracks[2].steps[14] = true;

    // --- SEQUENCER LOGIC ---
    let isPlaying = false;
    let currentStep = 0;
    let nextNoteTime = 0.0;
    let timerID;
    const lookahead = 25.0;
    const scheduleAheadTime = 0.1;

    function nextNote() {
        const secondsPerBeat = 60.0 / config.bpm;
        const secondsPer16th = secondsPerBeat / 4;
        nextNoteTime += secondsPer16th;
        currentStep = (currentStep + 1) % 16;
    }

    function scheduleNote(stepNumber, time) {
        // UI Sync
        const drawTime = (time - ctx.currentTime) * 1000;
        setTimeout(() => updateStepUI(stepNumber), Math.max(0, drawTime));

        // Audio Playback
        const isAnySolo = config.tracks.some(t => t.solo);

        config.tracks.forEach((track, index) => {
            if (track.steps[stepNumber]) {
                const shouldPlay = isAnySolo ? track.solo : !track.mute;
                
                if (shouldPlay) {
                    // Flash LED effect
                    setTimeout(() => flashLed(index), Math.max(0, drawTime));
                    
                    // Trigger Sound
                    switch(track.type) {
                        case 'kick': Synth.playKick(time, track.vol); break;
                        case 'snare': Synth.playSnare(time, track.vol); break;
                        case 'hat': Synth.playHiHat(time, track.vol); break;
                        case 'bass': Synth.playBass(time, track.vol); break;
                    }
                }
            }
        });
    }

    function scheduler() {
        while (nextNoteTime < ctx.currentTime + scheduleAheadTime) {
            scheduleNote(currentStep, nextNoteTime);
            nextNote();
        }
        timerID = setTimeout(scheduler, lookahead);
    }

    // --- UI UPDATES ---
    function updateStepUI(step) {
        document.querySelectorAll('.step').forEach(s => s.classList.remove('current'));
        document.querySelectorAll(`.step-col-${step}`).forEach(s => s.classList.add('current'));
    }

    function flashLed(trackIndex) {
        const leds = document.querySelectorAll('.led');
        if(leds[trackIndex]) {
            leds[trackIndex].classList.add('active');
            setTimeout(() => leds[trackIndex].classList.remove('active'), 100);
        }
    }

    // --- VISUALIZER ---
    const canvas = document.getElementById('visualizerCanvas');
    const canvasCtx = canvas.getContext('2d');
    
    function drawVisualizer() {
        requestAnimationFrame(drawVisualizer);
        analyser.getByteFrequencyData(dataArray);

        canvasCtx.fillStyle = 'rgba(0, 0, 0, 0.2)'; // Trail effect
        canvasCtx.fillRect(0, 0, canvas.width, canvas.height);

        const barWidth = (canvas.width / bufferLength) * 2.5;
        let barHeight;
        let x = 0;

        for(let i = 0; i < bufferLength; i++) {
            barHeight = dataArray[i] / 2;
            
            // Gradient color based on height
            const r = barHeight + (25 * (i/bufferLength));
            const g = 250 * (i/bufferLength);
            const b = 50;

            canvasCtx.fillStyle = `rgb(${r},${g},${b})`;
            canvasCtx.fillRect(x, canvas.height - barHeight, barWidth, barHeight);

            x += barWidth + 1;
        }
    }
    
    // Resize canvas
    function resizeCanvas() {
        canvas.width = canvas.parentElement.offsetWidth;
        canvas.height = canvas.parentElement.offsetHeight;
    }
    window.addEventListener('resize', resizeCanvas);
    resizeCanvas();
    drawVisualizer();

    // --- RENDER TRACKS ---
    const sequencerContainer = document.getElementById('sequencerTracks');

    function renderInterface() {
        // Clear except header
        const header = sequencerContainer.querySelector('.track-header');
        sequencerContainer.innerHTML = '';
        sequencerContainer.appendChild(header);

        config.tracks.forEach((track, tIndex) => {
            const row = document.createElement('div');
            row.className = 'track-row';
            
            // Controls
            const controls = document.createElement('div');
            controls.className = 'track-controls';
            
            controls.innerHTML = `
                <div class="track-name">
                    <div class="led"></div> ${track.name}
                </div>
                <div class="track-utils">
                    <button class="util-btn mute ${track.mute ? 'active':''}" onclick="toggleMute(${tIndex})">M</button>
                    <button class="util-btn solo ${track.solo ? 'active':''}" onclick="toggleSolo(${tIndex})">S</button>
                    <input type="range" class="vol-slider" min="0" max="1" step="0.01" value="${track.vol}" oninput="updateVol(${tIndex}, this.value)">
                </div>
            `;
            
            // Steps
            const grid = document.createElement('div');
            grid.className = 'step-grid';
            
            track.steps.forEach((isActive, sIndex) => {
                const step = document.createElement('div');
                step.className = `step step-col-${sIndex} ${isActive ? 'active' : ''}`;
                step.onclick = () => {
                    track.steps[sIndex] = !track.steps[sIndex];
                    renderInterface(); // Re-render to show update (Basit yöntem)
                };
                grid.appendChild(step);
            });

            row.appendChild(controls);
            row.appendChild(grid);
            sequencerContainer.appendChild(row);
        });
    }

    // --- CONTROL FUNCTIONS ---
    window.toggleMute = (idx) => { config.tracks[idx].mute = !config.tracks[idx].mute; renderInterface(); };
    window.toggleSolo = (idx) => { 
        // Exclusive solo logic (DAW style)
        const wasSolo = config.tracks[idx].solo;
        config.tracks.forEach(t => t.solo = false); // Clear all
        if (!wasSolo) config.tracks[idx].solo = true;
        renderInterface(); 
    };
    window.updateVol = (idx, val) => { config.tracks[idx].vol = parseFloat(val); };

    // --- EVENT LISTENERS ---
    const playBtn = document.getElementById('playBtn');
    const stopBtn = document.getElementById('stopBtn');
    const bpmSlider = document.getElementById('bpmSlider');
    const bpmVal = document.getElementById('bpmVal');

    playBtn.addEventListener('click', () => {
        if(ctx.state === 'suspended') ctx.resume();
        if(isPlaying) return;
        
        isPlaying = true;
        currentStep = 0;
        nextNoteTime = ctx.currentTime + 0.05;
        scheduler();
        playBtn.style.color = '#00ff88';
        playBtn.style.textShadow = '0 0 10px #00ff88';
    });

    stopBtn.addEventListener('click', () => {
        isPlaying = false;
        clearTimeout(timerID);
        document.querySelectorAll('.step').forEach(s => s.classList.remove('current'));
        playBtn.style.color = '';
        playBtn.style.textShadow = '';
    });

    bpmSlider.addEventListener('input', (e) => {
        config.bpm = parseInt(e.target.value);
        bpmVal.innerText = config.bpm;
    });

    // Save/Load Logic
    document.getElementById('saveBtn').addEventListener('click', () => {
        localStorage.setItem('nexusProject', JSON.stringify(config));
        alert('Proje Nexus Belleğine Kaydedildi!');
    });

    document.getElementById('loadBtn').addEventListener('click', () => {
        const saved = localStorage.getItem('nexusProject');
        if(saved) {
            const data = JSON.parse(saved);
            config.bpm = data.bpm;
            config.tracks = data.tracks;
            bpmSlider.value = config.bpm;
            bpmVal.innerText = config.bpm;
            renderInterface();
            alert('Proje Yüklendi!');
        } else {
            alert('Kayıtlı proje bulunamadı.');
        }
    });

    // Initial Render
    renderInterface();

</script>
</body>
</html>
